<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>Ada çš„æ³•å¾‹èµ„æ–™ä¸»é¡µ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
/* ä¿ç•™ä½ å…¨éƒ¨çš„æ ·å¼ */
body {
  font-family: "Helvetica Neue","PingFang SC","Microsoft YaHei",sans-serif;
  background:#f2f4f7;
  padding:20px;
  color:#333;
}
h1 { color:#003366; font-size:22px; text-align:center; margin:0 0 10px; }
p { text-align:center; font-size:13px; color:#666; margin:0 0 16px; }
#searchInput { display:block; margin:0 auto 10px; padding:10px 16px; width:90%; max-width:500px; border:1px solid #ccc; border-radius:24px; font-size:14px; }
#loading { text-align:center; font-size:13px; color:#999; margin-bottom:10px; }
ul#mhtmlList { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:16px; list-style:none; margin:0; padding:0; }
ul#mhtmlList li { background:#fff; border-radius:10px; padding:14px; box-shadow:0 2px 8px rgba(0,0,0,.05); font-size:14px; }
ul#mhtmlList li.group-header { grid-column:1 / -1; background:transparent; box-shadow:none; padding:4px 2px; font-size:13px; font-weight:600; color:#555; border-left:4px solid #007acc; }
ul#mhtmlList li a { color:#007acc; font-weight:600; text-decoration:none; word-break:break-all; }
.file-date { margin-top:6px; font-size:12px; color:#2e8b57; }
#noResults { display:none; text-align:center; margin-top:20px; font-size:13px; color:#888; }
.scroll-buttons { position:fixed; right:20px; bottom:40px; display:flex; flex-direction:column; gap:10px; z-index:999; }
.scroll-buttons button { background:#007acc; color:white; border:none; border-radius:20px; padding:6px 12px; font-size:13px; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,.2); }
</style>
</head>

<body>

<h1>Ada çš„æ³•å¾‹èµ„æ–™ä¸»é¡µ</h1>
<p>ä»¥ä¸‹èµ„æ–™ä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨ï¼Œç‚¹å‡»å¯ç›´æ¥æ‰“å¼€ã€‚</p>

<input id="searchInput" placeholder="ğŸ” æ ¹æ®æ ‡é¢˜æœç´¢â€¦" />
<div id="loading">æ­£åœ¨åŠ è½½ï¼Œè¯·ç¨å€™â€¦</div>

<ul id="mhtmlList"></ul>
<div id="noResults">æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</div>

<div class="scroll-buttons">
  <button onclick="window.scrollTo({ top: 0, behavior: 'smooth' })">â†‘ è¿”å›é¡¶éƒ¨</button>
  <button onclick="window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' })">â†“ è·³åˆ°åº•éƒ¨</button>
</div>

<script>
// â­â­ åªæ”¹åŠ¨è¿™é‡Œï¼šæ•°æ®æ¥æºä» API â†’ index.json â­â­
async function loadData() {
  const res = await fetch("index.json");
  if (!res.ok) throw new Error("æ— æ³•åŠ è½½ index.json");
  return res.json();
}

// === ä»¥ä¸‹é€»è¾‘ä¿æŒä½ çš„å…¨éƒ¨åŸåŠŸèƒ½ ===
function renderList(items) {
  const list = document.getElementById("mhtmlList");
  const loading = document.getElementById("loading");
  const noRes = document.getElementById("noResults");

  loading.style.display = "none";
  list.innerHTML = "";

  if (!items.length) {
    noRes.style.display = "block";
    return;
  }

  const groups = {};
  for (const it of items) {
    const key = it.dateGroupKey;
    if (!groups[key]) groups[key] = { label: it.dateGroupLabel, items: [] };
    groups[key].items.push(it);
  }

  const groupKeys = Object.keys(groups).sort((a,b)=>{
    if (a === "000000") return 1;
    if (b === "000000") return -1;
    return b.localeCompare(a);
  });

  for (const g of groupKeys) {
    const header = document.createElement("li");
    header.className = "group-header";
    header.dataset.group = g;
    header.textContent = groups[g].label;
    list.appendChild(header);

    groups[g].items.sort((a,b)=>{
      if (a.dateKey !== b.dateKey) return b.dateKey.localeCompare(a.dateKey);
      return a.title.localeCompare(b.title,"zh");
    });

    for (const it of groups[g].items) {
      const li = document.createElement("li");
      li.dataset.group = g;
      li.dataset.search = (it.title + " " + it.dateText).toLowerCase();
      li.innerHTML = `
        ğŸ”– <a href="${it.url}" target="_blank">${it.title}</a>
        <div class="file-date">${it.dateText}</div>
      `;
      list.appendChild(li);
    }
  }
}

function setupSearch() {
  const input = document.getElementById("searchInput");
  const noRes = document.getElementById("noResults");

  input.addEventListener("input", () => {
    const kw = input.value.trim().toLowerCase();
    let shown = 0;
    const groupShown = {};

    document.querySelectorAll("#mhtmlList li").forEach(li => {
      if (li.classList.contains("group-header")) return;

      const ok = !kw || li.dataset.search.includes(kw);
      li.style.display = ok ? "" : "none";
      if (ok) {
        shown++;
        groupShown[li.dataset.group] = true;
      }
    });

    document.querySelectorAll("#mhtmlList li.group-header").forEach(h=>{
      h.style.display = groupShown[h.dataset.group] ? "" : "none";
    });

    noRes.style.display = shown ? "none" : "block";
  });
}

async function init() {
  try {
    const items = await loadData();
    renderList(items);
    setupSearch();
  } catch (e) {
    document.getElementById("loading").innerText = "åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";
  }
}

document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
