<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Ada çš„æ³•å¾‹èµ„æ–™ä¸»é¡µ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: "Helvetica Neue", "PingFang SC", "Microsoft YaHei", sans-serif;
      background-color: #f2f4f7;
      margin: 0;
      padding: 20px;
      color: #333;
      line-height: 1.5;
    }

    h1 {
      color: #003366;
      font-size: 22px;
      margin-bottom: 10px;
      text-align: center;
    }

    p {
      text-align: center;
      font-size: 13px;
      color: #666;
      margin-bottom: 30px;
    }

    #searchInput {
      display: block;
      margin: 0 auto 30px;
      padding: 10px 16px;
      width: 90%;
      max-width: 500px;
      border: 1px solid #ccc;
      border-radius: 24px;
      font-size: 14px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    ul#mhtmlList {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
      padding: 0;
      margin: 0;
      list-style: none;
    }

    ul#mhtmlList li {
      background: #fff;
      border-radius: 10px;
      padding: 14px;
      font-size: 14px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      transition: all 0.2s ease;
      box-sizing: border-box;
    }

    ul#mhtmlList li:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transform: translateY(-1px);
    }

    ul#mhtmlList li a {
      font-weight: 600;
      color: #007acc;
      text-decoration: none;
      font-size: 14px;
      word-break: break-all;
    }

    ul#mhtmlList li a:hover {
      text-decoration: underline;
    }

    .file-meta {
      margin-top: 6px;
      font-size: 12px;
      color: #999;
    }

    #noResults {
      display: none;
      color: #888;
      margin-top: 20px;
      font-size: 14px;
      text-align: center;
    }

    .scroll-buttons {
      position: fixed;
      right: 20px;
      bottom: 40px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 999;
    }

    .scroll-buttons button {
      background-color: #007acc;
      color: white;
      border: none;
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 13px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      transition: background-color 0.2s ease;
    }

    .scroll-buttons button:hover {
      background-color: #005fa3;
    }
  </style>
</head>
<body>
  <h1>Ada çš„æ³•å¾‹èµ„æ–™ä¸»é¡µ</h1>
  <p>ä»¥ä¸‹èµ„æ–™ä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨ï¼Œç‚¹å‡»é“¾æ¥å¯ç›´æ¥é¢„è§ˆï¼š</p>

  <input type="text" id="searchInput" placeholder="ğŸ” æ ¹æ®æ ‡é¢˜æœç´¢ä¿å­˜çš„ç½‘é¡µ..." />

  <ul id="mhtmlList"></ul>
  <div id="noResults">æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</div>

  <!-- è¿”å›é¡¶éƒ¨ / åº•éƒ¨æŒ‰é’®ï¼Œå¯é€‰ -->
  <div class="scroll-buttons">
    <button onclick="window.scrollTo({ top: 0, behavior: 'smooth' });">â†‘ è¿”å›é¡¶éƒ¨</button>
    <button onclick="window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });">â†“ è·³è½¬åˆ°åº•éƒ¨</button>
  </div>

<script>
  // è¿™é‡Œç”¨ä½ çš„çœŸå®ç”¨æˆ·åå’Œä»“åº“å
  const owner  = "Ada-Ren";
  const repo   = "personal-legal-archive";
  const folder = "mhtml";

  // éœ€è¦æ”¯æŒçš„æ‰€æœ‰æ‰©å±•å
  const extsAll = [".html", ".mhtml", ".mht", ".pdf"];
  // éœ€è¦å°è¯•ä»å†…å®¹é‡Œè¯» <title> çš„æ‰©å±•å
  const extsNeedTitle = [".html", ".mhtml", ".mht"];

  async function fetchMHTMLList() {
    const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(folder)}`;
    const res = await fetch(apiUrl);
    console.log("GitHub API status:", res.status);
    if (!res.ok) {
      // åœ¨æ§åˆ¶å°æ‰“å°æ›´å¤šä¿¡æ¯ï¼Œæ–¹ä¾¿æ’æŸ¥
      const text = await res.text();
      console.error("GitHub API è¯·æ±‚å¤±è´¥ï¼Œå“åº”ï¼š", text);
      throw new Error("GitHub API è¯·æ±‚å¤±è´¥ï¼š" + res.status);
    }
    const data = await res.json();
    console.log("GitHub API è¿”å›æ•°æ®ï¼š", data);
    // é˜²å¾¡æ€§åˆ¤æ–­ï¼šç¡®ä¿ data æ˜¯æ•°ç»„
    if (!Array.isArray(data)) {
      throw new Error("GitHub API è¿”å›çš„ä¸æ˜¯æ•°ç»„ï¼Œè€Œæ˜¯ï¼š" + typeof data);
    }
    return data;
  }

  // ä» html/mhtml ä¸­æå– <title>
  async function extractTitleFromFile(path) {
    try {
      const res = await fetch(path);
      if (!res.ok) {
        console.warn("è·å–æ–‡ä»¶å¤±è´¥ï¼š", path, res.status);
        return null;
      }
      const text = await res.text();
      const match = text.match(/<title[^>]*>([\s\S]*?)<\/title>/i);
      if (match && match[1]) {
        return match[1].trim();
      }
    } catch (e) {
      console.error("è§£ææ ‡é¢˜å¤±è´¥ï¼š", path, e);
    }
    return null;
  }

  // ç”¨æ–‡ä»¶åå…œåº•æ ‡é¢˜
  function filenameToTitle(name) {
    return name
      .replace(/\.(html|pdf|mhtml|mht)$/i, "")
      .replace(/[_\-]+/g, " ")
      .trim();
  }

  function renderList(items) {
    const listEl = document.getElementById("mhtmlList");
    listEl.innerHTML = "";

    items.sort((a, b) => a.title.localeCompare(b.title, "zh"));

    items.forEach(item => {
      const li = document.createElement("li");
      li.dataset.searchText = item.title.toLowerCase();
      li.innerHTML = `
        ğŸ”– <a href="${item.url}" target="_blank">${item.title}</a>
        <div class="file-meta">${item.fileName}</div>
      `;
      listEl.appendChild(li);
    });
  }

  function setupSearch() {
    const input = document.getElementById("searchInput");
    const noResults = document.getElementById("noResults");

    input.addEventListener("input", () => {
      const keyword = input.value.trim().toLowerCase();
      const items = Array.from(document.querySelectorAll("#mhtmlList li"));
      let visibleCount = 0;

      items.forEach(li => {
        const text = li.dataset.searchText || "";
        const match = !keyword || text.includes(keyword);
        li.style.display = match ? "" : "none";
        if (match) visibleCount++;
      });

      noResults.style.display = visibleCount === 0 ? "block" : "none";
    });
  }

  async function init() {
    try {
      const rawFiles = await fetchMHTMLList();

      // è¿‡æ»¤å‡ºæˆ‘ä»¬å…³å¿ƒçš„æ‰©å±•å
      const files = rawFiles.filter(f =>
        extsAll.some(ext => f.name.toLowerCase().endsWith(ext))
      );
      console.log("ç­›é€‰åçš„æ–‡ä»¶ï¼š", files);

      const items = await Promise.all(
        files.map(async f => {
          const lower = f.name.toLowerCase();
          const encodedName = encodeURIComponent(f.name);
          const relativePath = `${folder}/${encodedName}`;

          let title = null;
          if (extsNeedTitle.some(ext => lower.endsWith(ext))) {
            title = await extractTitleFromFile(relativePath);
          }
          if (!title) {
            title = filenameToTitle(f.name);
          }

          return {
            fileName: f.name,
            title,
            url: `${folder}/${f.name}` // href ç”¨åŸå§‹æ–‡ä»¶åï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ç¼–ç 
          };
        })
      );

      renderList(items);
      setupSearch();
    } catch (err) {
      console.error("åˆå§‹åŒ–å‡ºé”™ï¼š", err);
      const noResults = document.getElementById("noResults");
      noResults.style.display = "block";
      noResults.textContent = "åŠ è½½ mhtml åˆ—è¡¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚";
    }
  }

  document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
