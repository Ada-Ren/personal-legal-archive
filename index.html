<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Ada çš„æ³•å¾‹èµ„æ–™ä¸»é¡µ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: "Helvetica Neue", "PingFang SC", "Microsoft YaHei", sans-serif;
      background-color: #f2f4f7;
      margin: 0;
      padding: 20px;
      color: #333;
      line-height: 1.5;
    }

    h1 {
      color: #003366;
      font-size: 22px;
      margin-bottom: 10px;
      text-align: center;
    }

    p {
      text-align: center;
      font-size: 13px;
      color: #666;
      margin-bottom: 30px;
    }

    #searchInput {
      display: block;
      margin: 0 auto 30px;
      padding: 10px 16px;
      width: 90%;
      max-width: 500px;
      border: 1px solid #ccc;
      border-radius: 24px;
      font-size: 14px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    ul#mhtmlList {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
      padding: 0;
      margin: 0;
      list-style: none;
    }

    ul#mhtmlList li {
      background: #fff;
      border-radius: 10px;
      padding: 14px;
      font-size: 14px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      transition: all 0.2s ease;
      box-sizing: border-box;
    }

    ul#mhtmlList li:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transform: translateY(-1px);
    }

    ul#mhtmlList li a {
      font-weight: 600;
      color: #007acc;
      text-decoration: none;
      font-size: 14px;
      word-break: break-all;
    }

    ul#mhtmlList li a:hover {
      text-decoration: underline;
    }

    .file-meta {
      margin-top: 6px;
      font-size: 12px;
      color: #999;
    }

    #noResults {
      display: none;
      color: #888;
      margin-top: 20px;
      font-size: 14px;
      text-align: center;
    }

    .scroll-buttons {
      position: fixed;
      right: 20px;
      bottom: 40px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 999;
    }

    .scroll-buttons button {
      background-color: #007acc;
      color: white;
      border: none;
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 13px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      transition: background-color 0.2s ease;
    }

    .scroll-buttons button:hover {
      background-color: #005fa3;
    }
  </style>
</head>
<body>
  <h1>Ada çš„æ³•å¾‹èµ„æ–™ä¸»é¡µ</h1>
  <p>ä»¥ä¸‹èµ„æ–™ä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨ï¼Œç‚¹å‡»é“¾æ¥å¯ç›´æ¥é¢„è§ˆï¼š</p>

  <input type="text" id="searchInput" placeholder="ğŸ” æ ¹æ®æ ‡é¢˜æœç´¢ä¿å­˜çš„ç½‘é¡µ..." />

  <ul id="mhtmlList"></ul>
  <div id="noResults">æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</div>

  <!-- è¿”å›é¡¶éƒ¨ / åº•éƒ¨æŒ‰é’®ï¼Œå¯é€‰ -->
  <div class="scroll-buttons">
    <button onclick="window.scrollTo({ top: 0, behavior: 'smooth' });">â†‘ è¿”å›é¡¶éƒ¨</button>
    <button onclick="window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });">â†“ è·³è½¬åˆ°åº•éƒ¨</button>
  </div>

  <script>
    // âš ï¸âš ï¸ è¿™é‡Œæ”¹æˆä½ è‡ªå·±çš„ GitHub ç”¨æˆ·åå’Œä»“åº“å âš ï¸âš ï¸
    const owner  = "Ada-Ren";   // æ¯”å¦‚ "ada-law"
    const repo   = "personal-legal-archive";         // æ¯”å¦‚ "mhtml-archive"
    const folder = "mhtml";                  // ä½ æ”¾ mhtml çš„æ–‡ä»¶å¤¹åç§°

    // è¯»å– /mhtml ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶åˆ—è¡¨ï¼ˆåªè¿™ä¸€å±‚ï¼Œä¸é€’å½’å­ç›®å½•ï¼Œå¦‚æœä»¥åè¦é€’å½’æˆ‘ä»¬å¯ä»¥å†å‡çº§ï¼‰
    async function fetchMHTMLList() {
      const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(folder)}`;
      const res = await fetch(apiUrl);
      if (!res.ok) {
        throw new Error("GitHub API è¯·æ±‚å¤±è´¥ï¼š" + res.status);
      }
      return res.json();
    }

    // ä» mhtml å†…å®¹é‡Œæå– <title>...</title>
    async function extractTitleFromMHTML(path) {
      try {
        // path ä¾‹å¦‚ "mhtml/xxx.mhtml"ï¼Œç›¸å¯¹å½“å‰ç«™ç‚¹æ ¹è·¯å¾„
        const res = await fetch(path);
        const text = await res.text();
        const match = text.match(/<title[^>]*>([\s\S]*?)<\/title>/i);
        if (match && match[1]) {
          return match[1].trim();
        }
      } catch (e) {
        console.error("è§£ææ ‡é¢˜å¤±è´¥ï¼š", path, e);
      }
      return null; // å¤±è´¥æ—¶äº¤ç»™æ–‡ä»¶åå…œåº•
    }

    // ç”¨æ–‡ä»¶åå…œåº•è½¬ä¸€ä¸ªå¯è¯»æ ‡é¢˜
    function filenameToTitle(name) {
      return name
        .replace(/\.mhtml?$/i, "")
        .replace(/[_\-]+/g, " ")
        .trim();
    }

    function renderList(items) {
      const listEl = document.getElementById("mhtmlList");
      listEl.innerHTML = "";

      // æŒ‰æ ‡é¢˜æ’åº
      items.sort((a, b) => a.title.localeCompare(b.title, "zh"));

      items.forEach(item => {
        const li = document.createElement("li");
        li.dataset.searchText = item.title.toLowerCase();

        li.innerHTML = `
          ğŸ”– <a href="${item.url}" target="_blank">${item.title}</a>
          <div class="file-meta">${item.fileName}</div>
        `;
        listEl.appendChild(li);
      });
    }

    function setupSearch() {
      const input = document.getElementById("searchInput");
      const noResults = document.getElementById("noResults");

      input.addEventListener("input", () => {
        const keyword = input.value.trim().toLowerCase();
        const items = Array.from(document.querySelectorAll("#mhtmlList li"));
        let visibleCount = 0;

        items.forEach(li => {
          const text = li.dataset.searchText || "";
          const match = !keyword || text.includes(keyword);
          li.style.display = match ? "" : "none";
          if (match) visibleCount++;
        });

        noResults.style.display = visibleCount === 0 ? "block" : "none";
      });
    }

    async function init() {
      try {
        const rawFiles = await fetchMHTMLList();

        // åªè¦ .mhtml / .mht
        const mhtmlFiles = rawFiles.filter(f =>
          f.name.toLowerCase().endsWith(".mhtml") ||
          f.name.toLowerCase().endsWith(".mht")
        );

        // å¯¹æ¯ä¸ªæ–‡ä»¶æŠ“æ ‡é¢˜ï¼ˆä»å†…å®¹é‡Œè¯» <title>ï¼Œå¤±è´¥å°±ç”¨æ–‡ä»¶åï¼‰
        const items = await Promise.all(
          mhtmlFiles.map(async f => {
            const relativePath = `${folder}/${encodeURIComponent(f.name)}`;
            const titleFromFile = await extractTitleFromMHTML(relativePath);
            const title = titleFromFile || filenameToTitle(f.name);
            return {
              fileName: f.name,
              title,
              url: `${folder}/${f.name}` // ç”¨æœªç¼–ç çš„ name ä½œä¸º hrefï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å¤„ç†
            };
          })
        );

        renderList(items);
        setupSearch();
      } catch (err) {
        console.error(err);
        const noResults = document.getElementById("noResults");
        noResults.style.display = "block";
        noResults.textContent = "åŠ è½½ mhtml åˆ—è¡¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚";
      }
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
