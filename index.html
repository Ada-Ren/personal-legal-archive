<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>Ada çš„æ³•å¾‹èµ„æ–™ä¸»é¡µ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  font-family: "Helvetica Neue","PingFang SC","Microsoft YaHei",sans-serif;
  background:#f2f4f7;
  margin:0;
  padding:20px;
  color:#333;
}

h1 {
  color:#003366;
  font-size:22px;
  text-align:center;
}

p {
  text-align:center;
  font-size:13px;
  color:#666;
  margin-bottom:20px;
}

#searchInput {
  display:block;
  margin:0 auto 14px;
  padding:10px 16px;
  width:90%;
  max-width:500px;
  border:1px solid #ccc;
  border-radius:24px;
  font-size:14px;
}

#loading {
  text-align:center;
  font-size:13px;
  color:#999;
  margin-bottom:10px;
}

ul#mhtmlList {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:16px;
  list-style:none;
  padding:0;
}

ul#mhtmlList li {
  background:#fff;
  border-radius:10px;
  padding:14px;
  box-shadow:0 2px 8px rgba(0,0,0,.05);
}

ul#mhtmlList li a {
  color:#007acc;
  font-weight:600;
  text-decoration:none;
  word-break:break-all;
}

ul#mhtmlList li a:hover {
  text-decoration:underline;
}

.file-date {
  margin-top:6px;
  font-size:12px;
  color:#2e8b57; /* âœ… ç»¿è‰²æ—¶é—´ */
}

#noResults {
  display:none;
  text-align:center;
  font-size:13px;
  color:#888;
  margin-top:20px;
}

/* è¿”å›é¡¶éƒ¨ / åº•éƒ¨æŒ‰é’® */
.scroll-buttons {
  position:fixed;
  right:20px;
  bottom:40px;
  display:flex;
  flex-direction:column;
  gap:10px;
  z-index:999;
}

.scroll-buttons button {
  background:#007acc;
  color:white;
  border:none;
  border-radius:20px;
  padding:6px 12px;
  font-size:13px;
  cursor:pointer;
}
</style>
</head>

<body>

<h1>Ada çš„æ³•å¾‹èµ„æ–™ä¸»é¡µ</h1>
<p>ä»¥ä¸‹èµ„æ–™ä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨ï¼Œç‚¹å‡»å¯ç›´æ¥æ‰“å¼€ã€‚</p>

<input id="searchInput" placeholder="ğŸ” æ ¹æ®æ ‡é¢˜æœç´¢â€¦" />
<div id="loading">æ­£åœ¨åŠ è½½ï¼Œè¯·ç¨å€™â€¦</div>

<ul id="mhtmlList"></ul>
<div id="noResults">æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</div>

<!-- è¿”å›é¡¶éƒ¨ / åº•éƒ¨ -->
<div class="scroll-buttons">
  <button onclick="window.scrollTo({ top: 0, behavior: 'smooth' })">â†‘ è¿”å›é¡¶éƒ¨</button>
  <button onclick="window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' })">â†“ è·³åˆ°åº•éƒ¨</button>
</div>

<script>
/* ========= é…ç½® ========= */
const owner  = "Ada-Ren";
const repo   = "personal-legal-archive";
const folder = "mhtml";
const EXTS   = [".html",".pdf",".mhtml",".mht"];

/* ========= å·¥å…· ========= */
function filenameToTitle(name) {
  return name
    .replace(/\.(html?|pdf|mhtml?)$/i,"")
    .replace(/[_\-]+/g," ")
    .trim();
}

// âœ… ä»æ–‡ä»¶åæå–æ—¶é—´
function extractDate(name) {
  const m = name.match(/(20\d{2})(?:[-_]?(\d{2}))?(?:[-_]?(\d{2}))?/);
  if (!m) return null;

  const y = m[1];
  const mo = m[2] || "01";
  const d  = m[3] || "01";

  return {
    text: m[0],                  // å±•ç¤ºç”¨
    key: `${y}${mo}${d}`         // æ’åºç”¨
  };
}

/* ========= ä¸»é€»è¾‘ ========= */
async function init() {
  const loading = document.getElementById("loading");
  const list    = document.getElementById("mhtmlList");
  const noRes   = document.getElementById("noResults");

  try {
    /* âœ… åªè°ƒç”¨ 1 æ¬¡ API */
    const api = `https://api.github.com/repos/${owner}/${repo}/contents/${folder}`;
    const res = await fetch(api);
    if (!res.ok) throw new Error(res.status);

    const data = await res.json();

    let items = data
      .filter(f => f.type === "file" && EXTS.some(ext => f.name.toLowerCase().endsWith(ext)))
      .map(f => {
        const date = extractDate(f.name);
        return {
          title: filenameToTitle(f.name),
          dateText: date ? date.text : "æœªçŸ¥æ—¶é—´",
          dateKey:  date ? date.key : "00000000",
          url: encodeURI(f.path)
        };
      });

    /* âœ… æ’åºï¼šæ—¶é—´å€’åº â†’ åŒæ—¶é—´æŒ‰ä¸­æ–‡æ’åº */
    items.sort((a,b) => {
      if (a.dateKey !== b.dateKey) {
        return b.dateKey.localeCompare(a.dateKey);
      }
      return a.title.localeCompare(b.title,"zh");
    });

    loading.style.display = "none";

    if (!items.length) {
      noRes.style.display = "block";
      return;
    }

    for (const it of items) {
      const li = document.createElement("li");
      li.dataset.search = it.title.toLowerCase();
      li.innerHTML = `
        ğŸ”– <a href="${it.url}" target="_blank">${it.title}</a>
        <div class="file-date">ğŸ“… ${it.dateText}</div>
      `;
      list.appendChild(li);
    }

    /* æœç´¢ */
    document.getElementById("searchInput").addEventListener("input", e => {
      const kw = e.target.value.trim().toLowerCase();
      let shown = 0;
      document.querySelectorAll("#mhtmlList li").forEach(li => {
        const ok = !kw || li.dataset.search.includes(kw);
        li.style.display = ok ? "" : "none";
        if (ok) shown++;
      });
      noRes.style.display = shown ? "none" : "block";
    });

  } catch (e) {
    console.error(e);
    loading.innerText = "åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";
  }
}

document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
