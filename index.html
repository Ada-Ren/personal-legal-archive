<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>Ada çš„æ³•å¾‹èµ„æ–™ä¸»é¡µ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  font-family: "Helvetica Neue","PingFang SC","Microsoft YaHei",sans-serif;
  background:#f2f4f7;
  margin:0;
  padding:20px;
  color:#333;
  line-height:1.5;
}

h1 {
  color:#003366;
  font-size:22px;
  text-align:center;
  margin:0 0 10px;
}

p {
  text-align:center;
  font-size:13px;
  color:#666;
  margin:0 0 16px;
}

#searchInput {
  display:block;
  margin:0 auto 10px;
  padding:10px 16px;
  width:90%;
  max-width:500px;
  border:1px solid #ccc;
  border-radius:24px;
  font-size:14px;
}

#loading {
  text-align:center;
  font-size:13px;
  color:#999;
  margin-bottom:10px;
}

/* åˆ—è¡¨æ•´ä½“æ˜¯ç½‘æ ¼å¸ƒå±€ */
ul#mhtmlList {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:16px;
  list-style:none;
  padding:0;
  margin:0;
}

ul#mhtmlList li {
  background:#fff;
  border-radius:10px;
  padding:14px;
  box-shadow:0 2px 8px rgba(0,0,0,.05);
  font-size:14px;
}

/* åˆ†ç»„æ ‡é¢˜ï¼šå æ»¡æ•´è¡Œ */
ul#mhtmlList li.group-header {
  grid-column:1 / -1;
  background:transparent;
  box-shadow:none;
  padding:4px 2px;
  font-size:13px;
  font-weight:600;
  color:#555;
  border-left:4px solid #007acc;
}

ul#mhtmlList li a {
  color:#007acc;
  font-weight:600;
  text-decoration:none;
  word-break:break-all;
}

ul#mhtmlList li a:hover {
  text-decoration:underline;
}

.file-date {
  margin-top:6px;
  font-size:12px;
  color:#2e8b57; /* ç»¿è‰²æ—¶é—´ */
}

#noResults {
  display:none;
  text-align:center;
  font-size:13px;
  color:#888;
  margin-top:20px;
}

/* è¿”å›é¡¶éƒ¨ / åº•éƒ¨æŒ‰é’® */
.scroll-buttons {
  position:fixed;
  right:20px;
  bottom:40px;
  display:flex;
  flex-direction:column;
  gap:10px;
  z-index:999;
}

.scroll-buttons button {
  background:#007acc;
  color:white;
  border:none;
  border-radius:20px;
  padding:6px 12px;
  font-size:13px;
  cursor:pointer;
  box-shadow:0 2px 6px rgba(0,0,0,.2);
}
.scroll-buttons button:hover {
  background:#005fa3;
}
</style>
</head>

<body>
  <h1>Ada çš„æ³•å¾‹èµ„æ–™ä¸»é¡µ</h1>
  <p>ä»¥ä¸‹èµ„æ–™ä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨ï¼Œç‚¹å‡»å¯ç›´æ¥æ‰“å¼€ã€‚</p>

  <input id="searchInput" placeholder="ğŸ” æ ¹æ®æ ‡é¢˜æˆ–æ—¥æœŸæœç´¢â€¦" />
  <div id="loading">æ­£åœ¨åŠ è½½ï¼Œè¯·ç¨å€™â€¦</div>

  <ul id="mhtmlList"></ul>
  <div id="noResults">æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</div>

  <!-- è¿”å›é¡¶éƒ¨ / åº•éƒ¨ -->
  <div class="scroll-buttons">
    <button onclick="window.scrollTo({ top: 0, behavior: 'smooth' })">â†‘ è¿”å›é¡¶éƒ¨</button>
    <button onclick="window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' })">â†“ è·³åˆ°åº•éƒ¨</button>
  </div>

<script>
// æ¸²æŸ“åˆ†ç»„åˆ—è¡¨
function renderList(items) {
  const list    = document.getElementById("mhtmlList");
  const loading = document.getElementById("loading");
  const noRes   = document.getElementById("noResults");

  loading.style.display = "none";
  list.innerHTML = "";

  if (!items.length) {
    noRes.style.display = "block";
    return;
  }
  noRes.style.display = "none";

  // å…ˆæŒ‰ groupKey å½’ç»„
  const groups = {};
  for (const it of items) {
    const gKey   = it.dateGroupKey || "000000";
    const gLabel = it.dateGroupLabel || "æœªçŸ¥æ—¥æœŸ";
    if (!groups[gKey]) {
      groups[gKey] = { label: gLabel, items: [] };
    }
    groups[gKey].items.push(it);
  }

  // åˆ†ç»„æ’åºï¼šå¹´æœˆå€’åºï¼ŒæœªçŸ¥æ—¥æœŸæœ€å
  const groupKeys = Object.keys(groups).sort((a, b) => {
    if (a === "000000") return 1;
    if (b === "000000") return -1;
    return b.localeCompare(a);
  });

  for (const gKey of groupKeys) {
    const group = groups[gKey];

    // ç»„æ ‡é¢˜
    const headerLi = document.createElement("li");
    headerLi.className = "group-header";
    headerLi.dataset.group = gKey;
    headerLi.textContent = group.label;
    list.appendChild(headerLi);

    // ç»„å†…æ’åºï¼šæ—¶é—´å€’åº + æ ‡é¢˜æ‹¼éŸ³åº
    group.items.sort((a, b) => {
      if (a.dateKey !== b.dateKey) {
        return b.dateKey.localeCompare(a.dateKey);
      }
      return a.title.localeCompare(b.title, "zh");
    });

    // ç»„å†…æ–‡ä»¶
    for (const it of group.items) {
      const li = document.createElement("li");
      li.dataset.group  = gKey;
      li.dataset.search = (it.title + " " + it.dateText).toLowerCase();
      li.innerHTML = `
        ğŸ”– <a href="${it.url}" target="_blank">${it.title}</a>
        <div class="file-date">${it.dateText}</div>
      `;
      list.appendChild(li);
    }
  }
}

// æœç´¢é€»è¾‘
function setupSearch() {
  const input   = document.getElementById("searchInput");
  const noRes   = document.getElementById("noResults");
  const loading = document.getElementById("loading");

  input.addEventListener("input", () => {
    const kw = input.value.trim().toLowerCase();
    let shown = 0;
    const groupVisibleCount = {};

    document.querySelectorAll("#mhtmlList li").forEach(li => {
      if (li.classList.contains("group-header")) return;

      const text = li.dataset.search || "";
      const ok   = !kw || text.includes(kw);
      li.style.display = ok ? "" : "none";
      if (ok) {
        shown++;
        const g = li.dataset.group;
        groupVisibleCount[g] = (groupVisibleCount[g] || 0) + 1;
      }
    });

    // æ§åˆ¶ç»„æ ‡é¢˜æ˜¾ç¤º
    document.querySelectorAll("#mhtmlList li.group-header").forEach(header => {
      const g = header.dataset.group;
      header.style.display = groupVisibleCount[g] ? "" : "none";
    });

    if (loading.style.display === "none") {
      noRes.style.display = shown ? "none" : "block";
    }
  });
}

// åˆå§‹åŒ–ï¼šåªè¯»æœ¬åœ° index.jsonï¼Œä¸æ‰“ GitHub API
async function init() {
  const loading = document.getElementById("loading");
  loading.textContent = "æ­£åœ¨è¯»å– index.jsonâ€¦";

  try {
    const res = await fetch("index.json?_=" + Date.now());
    if (!res.ok) throw new Error("è¯»å– index.json å¤±è´¥ï¼š" + res.status);
    const items = await res.json();
    if (!Array.isArray(items)) {
      throw new Error("index.json æ ¼å¼ä¸æ­£ç¡®");
    }
    renderList(items);
    setupSearch();
  } catch (e) {
    console.error(e);
    loading.textContent = "åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ï¼ˆindex.json æ— æ³•è¯»å–ï¼‰";
  }
}

document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
